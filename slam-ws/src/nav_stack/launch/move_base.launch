<launch>
  <arg name="global_costmap_params" default="$(find nav_stack)/config/global_costmap_params.yaml"/> 
  <arg name="caffeine" default="false"/> 

  <master auto="start"/>

  <!-- Remap cmd_vel topic name from keyboard teleop -->
  <node name="teleop_twist_keyboard" pkg="teleop_twist_keyboard" type="teleop_twist_keyboard.py">
    <remap from="cmd_vel" to="key_vel"/>
  </node>

  <!-- Run Move Base -->
  <node pkg="move_base" type="move_base" respawn="false" name="move_base" output="screen">
    <!-- Set Odometry source topic -->
    <remap from="odom" to="odometry/filtered"/>

    <!-- Use filtered LIDAR scan -->
    <remap from="scan" to="scan_filtered"/>

    <!-- Load costmap_common_params for both the global and local costmaps -->
    <rosparam file="$(find nav_stack)/config/caffeine_costmap_common_params.yaml" command="load" ns="global_costmap" if="$(arg caffeine)" /> 
    <rosparam file="$(find nav_stack)/config/caffeine_costmap_common_params.yaml" command="load" ns="local_costmap" if="$(arg caffeine)" />
    
    <rosparam file="$(find nav_stack)/config/husky_costmap_common_params.yaml" command="load" ns="global_costmap" unless="$(arg caffeine)" /> 
    <rosparam file="$(find nav_stack)/config/husky_costmap_common_params.yaml" command="load" ns="local_costmap" unless="$(arg caffeine)" />
    
    <!-- Load costmap (global/local) specific parameters -->
    <rosparam file="$(find nav_stack)/config/local_costmap_params.yaml" command="load" />
    <rosparam file="$(arg global_costmap_params)" command="load" /> 

    <!-- Load parameters for the base_local_planner -->
    <rosparam file="$(find nav_stack)/config/base_local_planner_params.yaml" command="load" />
    
    <!-- Set control loop frequency to an appropriate rate -->
    <param name="controller_frequency" value="10.0" />

    <!-- Rename cmd_vel topic name from move_base -->
    <remap from="cmd_vel" to="nav_vel"/>
  </node> 

  <arg name="config_locks"  default="$(find twist_mux)/config/twist_mux_locks.yaml"/>
  <arg name="config_topics" default="$(find twist_mux)/config/twist_mux_topics.yaml"/>

  <node pkg="twist_mux" type="twist_mux" name="twist_mux" output="screen">
    <remap from="cmd_vel_out" to="cmd_vel"/>

    <rosparam file="$(arg config_locks)"  command="load"/>
    <rosparam file="$(arg config_topics)" command="load"/>
  </node>

  <node pkg="twist_mux" type="twist_marker" name="twist_marker">
    <remap from="twist"  to="cmd_vel"/>
    <remap from="marker" to="twist_marker"/>
  </node>
</launch> 
